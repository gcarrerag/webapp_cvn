import { NextResponse } from "next/server";
import db from "../../../db";

export async function POST(request) {
  const body = await request.json();
  const { nom, telefon, adreca, observacions, productes } = body;
  const data = new Date().toISOString();

  const insert = db.prepare(`
    INSERT INTO comandes (nom, telefon, adreca, observacions, productes, data)
    VALUES (?, ?, ?, ?, ?, ?)
  `);
  insert.run(nom, telefon, adreca, observacions, JSON.stringify(productes), data);

  return NextResponse.json({ missatge: "Comanda desada a la base de dades âœ…" });
}

export async function GET() {
  const select = db.prepare(`SELECT * FROM comandes ORDER BY data DESC`);
  const comandes = select.all();
  return NextResponse.json(comandes);
}
